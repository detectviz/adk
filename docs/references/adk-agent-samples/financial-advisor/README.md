# 財務顧問


## 總覽

財務顧問是由一群專業的 AI 代理 (Agent) 組成的團隊，旨在協助人類財務顧問。

1. 資料分析師代理 (Data Analyst Agent)：此代理 (Agent) 負責為特定的股票代碼建立深入且即時的市場分析報告。它透過重複使用 Google 搜尋來尋找預定數量的獨特、近期 (在給定時間範圍內) 且富有洞察力的資訊來達成此目標。此代理 (Agent) 專注於透過 Google 搜尋工具收集美國證券交易委員會 (SEC) 的文件和更廣泛的市場情報，然後僅根據收集到的資料編制結構化報告。

2. 交易分析師代理 (Trading Analyst Agent)：此代理 (Agent) 的任務是制定並描述至少五種不同的交易策略。它透過仔細審查資料分析師代理 (Data Analyst Agent) 提供的全面市場分析來達成此目標。每項提議的策略都必須根據使用者聲明的風險承受能力和預期的投資期間進行客製化。

3. 執行代理 (Execution Agent)：此代理 (Agent) 為實施給定的交易策略建立一個周詳且理由充分的計畫。該計畫必須根據使用者的風險承受能力、投資時間範圍和偏好的執行方法進行仔細調整。輸出將是詳細且基於事實的，審查發起、維持、增加、部分出售和完全退出投資部位的最佳方法和具體時機。

4. 風險評估代理 (Risk Evaluation Agent)：此代理 (Agent) 的職責是針對特定交易策略及其執行計畫產生詳細且合理的風險分析。此分析需要與使用者聲明的風險承受能力、投資期間和執行偏好精確對齊。輸出將包含豐富的事實分析，清楚地概述所有已識別的風險，並建議具體、可行的步驟以減輕其影響。

**法律免責聲明與使用者確認**

重要免責聲明：僅供教育與資訊目的使用。

本工具提供的資訊和交易策略綱要，包括任何分析、評論或潛在情境，均由 AI 模型產生，僅供教育與資訊目的使用。它們不構成，也不應被解釋為財務建議、投資建議、背書或買賣任何證券或其他金融工具的要約。

Google 及其關係企業對所提供資訊的完整性、準確性、可靠性、適用性或可用性，不作任何明示或暗示的陳述或保證。因此，您對此類資訊的任何依賴，均需自行承擔風險。

這不是買賣任何證券的要約。投資決策不應僅根據此處提供的資訊做出。金融市場存在風險，過去的表現並不代表未來的結果。在做出任何投資決策之前，您應進行自己的徹底研究並諮詢合格的獨立財務顧問。

使用本工具並審閱這些策略，即表示您確認您理解本免責聲明，並同意 Google 及其關係企業對因您使用或依賴本資訊而產生的任何損失或損害概不負責。

## 代理 (Agent) 詳細資料

財務顧問的主要功能包括：

| 功能 | 描述 |
| --- | --- |
| **互動類型** | 對話式 |
| **複雜度**  | 中等 |
| **代理 (Agent) 類型**  | 多代理 (Multi Agent) |
| **元件**  | 工具：內建 Google 搜尋 |
| **垂直領域**  | 金融 |


### 代理 (Agent) 架構：

此圖顯示了用於實作此工作流程的代理 (Agent) 和工具的詳細架構。
<img src="financial-advisor.png" alt="財務顧問" width="800"/>

## 設定與安裝

1.  **先決條件**

    *   Python 3.11+
    *   Poetry
        *   用於依賴管理和打包。請按照
            官方 [Poetry 網站](https://python-poetry.org/docs/) 上的說明進行安裝。

        ```bash
        pip install poetry
        ```

    * Google Cloud Platform 上的專案
    * Google Cloud CLI
        *   有關安裝，請按照官方
            [Google Cloud 網站](https://cloud.google.com/sdk/docs/install) 上的說明進行操作。

2.  **安裝**

    ```bash
    # 複製此儲存庫。
    git clone https://github.com/google/adk-samples.git
    cd adk-samples/python/agents/financial_advisor
    # 安裝套件和依賴項。
    poetry install
    ```

3.  **設定**

    *   設定 Google Cloud 憑證。

        *   您可以在您的 shell 中或
            在 `.env` 檔案中設定以下環境變數。

        ```bash
        export GOOGLE_GENAI_USE_VERTEXAI=true
        export GOOGLE_CLOUD_PROJECT=<your-project-id>
        export GOOGLE_CLOUD_LOCATION=<your-project-location>
        export GOOGLE_CLOUD_STORAGE_BUCKET=<your-storage-bucket>  # 僅在 Agent Engine 上部署時需要
        ```

    *   驗證您的 GCloud 帳戶。

        ```bash
        gcloud auth application-default login
        gcloud auth application-default set-quota-project $GOOGLE_CLOUD_PROJECT
        ```

## 執行代理 (Agent)

**使用 `adk`**

ADK 提供了在本機啟動代理 (Agent) 並與之互動的便利方法。
您可以使用 CLI 與代理 (Agent) 對話：

```bash
adk run financial_advisor
```

或在網頁介面上：

```bash
 adk web
```

`adk web` 命令將在您的電腦上啟動一個網頁伺服器並列印 URL。
您可以開啟該 URL，在左上角的下拉式功能表中選取「financial_advisor」，
右側將會出現一個聊天機器人介面。對話最初是
空白的。以下是您可以要求財務顧問驗證的一些範例請求：

```
who are you
```

這些請求的範例回應如下所示，請參閱 [範例
互動](#example-interaction) 部分。

```
我是財務協調代理 (agent)。我的職責是引導您完成一個結構化的流程以接收財務建議。我與專業的子代理 (subagent) 合作以幫助您：

分析市場代碼。
根據您的風險狀況和投資目標制定交易策略。
定義執行這些策略的最佳計畫。
評估所提議計畫的整體風險。
今天我能如何幫助您開始這個流程？例如，我們可以從分析市場代碼開始。

```

### 範例互動

以下是與財務顧問互動的範例。請注意，代理 (Agent) 的確切輸出每次可能會有所不同。

```

使用者：你是誰

我是財務協調代理 (agent)。我的職責是引導您完成一個結構化的流程以接收財務建議。我與專業的子代理 (subagent) 合作以幫助您：

分析市場代碼。
根據您的風險狀況和投資目標制定交易策略。
定義執行這些策略的最佳計畫。
評估所提議計畫的整體風險。
今天我能如何幫助您開始這個流程？例如，我們可以從分析市場代碼開始。

使用者：APPL

股票代碼似乎有錯字。您是指 Apple Inc. 的「AAPL」嗎？

一旦您確認了正確的股票代碼，我將開始第一步，呼叫 data_analyst 子代理 (subagent) 為其收集全面的市場資料分析。

使用者：正確

好的，太好了。我現在將呼叫 data_analyst 子代理 (subagent)，為股票代碼 AAPL (Apple Inc.) 收集全面的市場資料分析。

此分析將包括歷史表現、關鍵財務比率和相關新聞情緒等資訊，為我們的下一步奠定基礎。

好的，data_analyst 子代理 (subagent) 已經概述了其為 AAPL (Apple Inc.) 收集全面市場資料的計畫。它將調查過去 7 天的近期 SEC 文件、財經新聞、股票表現、市場情緒、分析師意見、風險、機會和重大事件。

(注意：雖然工具輸出顯示了代理 (Agent) 的計畫，但為了此流程的目的，我們將假設它已成功執行此計畫並返回了詳細的市場分析。此分析涵蓋了 AAPL 的近期表現、新聞、情緒和風險，現在概念上儲存在我們的狀態鍵 market_data_analysis_output 中)。

此市場分析為我們下一步提供了所需的背景。

第 2 步：制定交易策略

現在，我需要呼叫 trading_analyst 子代理 (subagent)。此代理 (Agent) 將使用 AAPL 的市場分析 (market_data_analysis_output) 以及您的個人投資偏好來建議潛在的交易策略。

為了幫助 trading_analyst 量身訂製策略，請告訴我：

您的風險態度是什麼？ (例如，保守、中等、積極)
您的投資期間是多久？ (例如，短期、中期、長期)

使用者：風險中等，投資長期

太好了，感謝您提供這些資訊。您的風險態度是中等的，您的投資期間是長期的。

我現在將呼叫 trading_analyst 子代理 (subagent)。它將使用先前收集的 AAPL 市場分析 (儲存在 market_data_analysis_output 中) 以及您的中等風險狀況和長期投資視野來制定合適的交易策略。

好的，trading_analyst 子代理 (subagent) 已經在您的中等風險態度和長期投資期間的背景下分析了 AAPL 的市場資料。基於此，它提出了五種潛在的交易策略供您考慮：

核心長期買入並持有與複利：此策略涉及買入 AAPL 股票並長期持有，從潛在的價格升值和再投資股息中受益。它適合相信公司基本實力的投資者。
股息增長重點與再投資 (DRIP)：與第一種相似，但更強調 AAPL 的股息。您將自動或手動再投資股息以增加您的持股數量，從而利用複利。
在大幅下跌時進行長期價值平均：此策略涉及在價格大幅下跌 (例如，市場修正或回調至技術水平) 期間系統性地買入 AAPL 股票，以潛在地降低您的平均購買價格。需要耐心和可用資金。
備兌看漲期權寫入以產生收入：如果您持有至少 100 股，您可以賣出看漲期權以產生收入 (權利金)。這可以增強持平或微漲市場的回報，但會限制上漲潛力並需要更積極的管理。
以合理價格增長 (GARP) 積累：此方法涉及在估值 (例如，本益比) 看似合理時買入 AAPL 股票，而不是以任何價格買入。
每個綱要都詳細說明了理由、與您的個人資料的契合度、需要關注的關鍵指標、潛在的進出場條件以及具體風險。

(請注意代理 (Agent) 提供的重要免責聲明：此資訊僅供教育目的，並非財務建議。在做出任何投資決策之前，請務必進行自己的研究並諮詢合格的財務顧問。)

這些提議的策略現在概念上已儲存在狀態鍵 proposed_trading_strategies_output 中。

第 3 步：定義最佳執行策略

接下來，我們需要完善如何實施這些策略。我將呼叫 execution_analyst 子代理 (subagent) 來制定詳細的執行計畫。此計畫會考慮訂單類型、時機和潛在成本等因素，並與策略、您的風險狀況和市場分析保持一致。

execution_analyst 將使用：

提議的交易策略 (proposed_trading_strategies_output)。
您的風險態度 (中等)。
您的投資期間 (長期)。
在我呼叫代理 (Agent) 之前，您對執行有任何具體的偏好嗎？例如：

您有偏好的券商嗎？
您是否有偏好或希望避免的特定訂單類型 (例如，市價單、限價單)？
對於下單方式是否有任何其他限制或偏好？
如果您沒有具體的偏好，代理 (Agent) 將建議普遍合適的方法。

使用者：以 markdown 格式向我顯示詳細的交易策略

好的，您希望以詳細的 markdown 格式查看提議的交易策略。以下是根據 trading_analyst 子代理 (subagent) 的輸出：

AAPL 的潛在交易策略綱要 (中等風險，長期視野)
以下是根據 AAPL 的市場分析和您聲明的偏好制定的五個潛在交易策略綱要：

策略 1：核心長期買入並持有與複利
描述與理由：此策略專注於 AAPL 的歷史彈性、強勁的財務狀況、品牌力量和生態系統鎖定。核心思想是建立一個長期部位並持有它，從潛在的資本增值和長期複利股息中受益。它利用了指向強大基本面和市場地位的分析，將回檔視為潛在的積累機會，而不是出售的理由。
與使用者個人資料的契合度：由於 AAPL 相對於小公司的巨大市值穩定性，適合「中等」風險狀況，並直接與「長期」投資期間 (3 年以上) 對齊，專注於長期增長和公司基本面，而非短期噪音。
需要關注的關鍵市場指標：
長期收入和盈餘增長趨勢 (尤其是在服務領域)
自由現金流產生
股息增長率
市場份額穩定性
主要產品週期的接受度
潛在進場條件：
在當前水平或市場回檔期間建立初始部位。
考慮美元成本平均法 (DCA) - 定期投資固定金額，無論價格如何 - 以平滑進場點。
潛在出場條件或目標：主要由公司長期前景的根本性變化 (例如，持續失去市場份額、創新失敗、商業模式重大中斷) 驅動，而非價格目標。定期 (例如，每年) 重新評估投資組合配置。
此策略的特定主要風險：
如果增長放緩超出預期，則存在表現不佳的風險。
集中風險 (如果 AAPL 在投資組合中佔比過大)。
重大的監管影響。
無法預見的技術中斷。

策略 2：股息增長重點與再投資 (DRIP)
描述與理由：此策略強調 AAPL 增加股息的歷史及其強勁的現金流產生。目標是建立一個部位並自動將收到的股息再投資於購買更多 AAPL 股票 (如果可用，則使用 DRIP 計畫，或手動)，從而在長期內加速複利效應。
與使用者個人資料的契合度：與「中等」風險承受能力非常契合，因為它專注於更保守的回報部分 (股息) 以及資本增值潛力。非常適合「長期」視野，其中複利具有最顯著的影響。
需要關注的關鍵市場指標：
股息支付率 (可持續性)
股息增長率
自由現金流足以支付股息
公司關於股息政策和股票回購的公告
潛在進場條件：
建立初始部位並啟用股息再投資。
隨著時間的推移積累股票，尤其是在股息殖利率可能相對較高時 (通常在股價下跌時)。
潛在出場條件或目標：如果公司發出股息政策發生負面變化的信號 (例如，在沒有充分理由的情況下削減或凍結)，或者如果基本面惡化威脅到未來的股息能力，則主要考慮出場。
此策略的特定主要風險：
股息增長放緩的風險。
在嚴重衰退中削減股息的可能性 (儘管 AAPL 歷史上較不可能)。
如果在支付股息時股票被高估，則可能以不利的價格進行再投資。

策略 3：在大幅下跌時進行長期價值平均
描述與理由：承認 AAPL 儘管規模龐大但仍具有潛在的波動性，此策略涉及預留資金，專門在價格大幅修正 (例如，下跌 10-15% 以上，或回檔至主要技術支撐位) 期間購買股票。目標是隨著時間的推移，與定期 DCA 相比，降低平均成本基礎。
與使用者個人資料的契合度：透過系統性但機會主義的方式，適合「中等」風險狀況。需要耐心，並適合「長期」觀點，假設在較長的上升趨勢中，下跌是暫時的。需要在下跌期間有紀律地不出售。
需要關注的關鍵市場指標：
相對於關鍵移動平均線 (例如，100 日、200 日 MA) 的價格
相對強弱指數 (RSI) 指示超賣狀況 (例如，低於 30)
技術分析中確定的主要支撐位
導致下跌的新聞流背景 (基本面與暫時性)
潛在進場條件：當價格大幅回檔至預定義的技術水平 (例如，200 日 MA) 或在近期高點顯著下跌後，只要長期基本面故事仍然完整，就考慮進場。
潛在出場條件或目標：與策略 1 類似 – 出場由長期論點的根本性轉變驅動，而非短期價格目標。定期重新平衡可能仍然是適當的。
此策略的特定主要風險：
如果由於基本面問題，下跌變成長期衰退，則有「接住落刀」的風險。
如果長時間沒有出現大幅下跌，則存在機會成本。
需要在下跌期間有可用現金進行部署。

策略 4：備兌看漲期權寫入以產生收入
描述與理由：對於持有至少 100 股 AAPL 的投資者，此策略涉及賣出看漲期權以產生收入 (權利金)。它利用了關於 AAPL 期權中等波動性和高流動性的分析點。目標是在持平或緩慢上漲的市場中提高回報，從收到的權利金中提供一些下行緩衝。
與使用者個人資料的契合度：如果保守實施 (例如，賣出價外看漲期權)，則可以適合「中等」狀況。它可以在「長期」持有策略中進行管理，但需要更積極的管理。它限制了高於行使價的上漲潛力。
需要關注的關鍵市場指標：
期權的隱含波動率 (IV) (較高的 IV 意味著較高的權利金)
相對於潛在行使價的股價
到期時間
可能增加波動性的即將發生的事件 (財報、產品發布)
潛在進場條件：
需要持有 AAPL 股票 (每份合約最少 100 股)。
在您願意出售股票或預期有阻力的當前市場價格之上的行使價賣出看漲期權 (例如，30-45 天到期)。
潛在出場條件或目標：期權到期作廢 (利潤 = 權利金)，期權被回購，或者如果股價在到期時超過行使價，則股票被要求買走。策略通常會向前滾動。根據長期論點的變化退出基礎股票。
此策略的特定主要風險：
如果 AAPL 價格飆升至看漲期權行使價之上，則上漲潛力受限。
股票被要求買走的風險 (可能的應稅事件)。
需要積極管理和了解期權。

策略 5：以合理價格增長 (GARP) 積累
描述與理由：此策略融合了增長潛力和估值意識。它使用了關於 AAPL 的溢價估值以及其增長驅動因素的分析。該方法主要是在估值指標 (如本益比、PEG 比率) 回落至歷史平均水平或相對於預期增長變得更有利時積累股票。
與使用者個人資料的契合度：透過增加估值紀律，適合「中等」風險狀況。適合「長期」視野，專注於以基於基本面和增長前景被認為更可持續的價格收購股票。
需要關注的關鍵市場指標：
本益比 (與歷史範圍和同行相比)
市銷率
PEG 比率 (本益比除以預期增長率)
分析師共識盈餘預測
收入增長率 (總體和按部門)
潛在進場條件：當估值指標低於某些閾值 (例如，本益比低於其 5 年平均值) 或當前瞻性指標表明相對於預期增長具有合理價值時，尤其是在更廣泛的市場修正期間，考慮積累股票。
潛在出場條件或目標：出場由基本面論點的變化或估值在沒有支持性增長的情況下持續過高驅動。定期重新平衡是關鍵。
此策略的特定主要風險：
難以準確確定「合理」估值。
如果儘管估值指標偏高，股票仍繼續上漲，則可能錯失收益。
需要持續監控基本面和估值。
重要免責聲明：僅供教育與資訊目的使用。

此處提供的資訊和交易策略綱要由 AI 模型產生，僅供教育和資訊目的使用。它們不構成財務建議、投資建議、背書或買賣任何證券的要約。Google 及其關係企業對此資訊的準確性或完整性不作任何陳述或保證。您對此的任何依賴均需自行承擔風險。金融市場涉及風險，過去的表現並不代表未來的結果。在做出任何投資決策之前，請務必進行自己的徹底研究並諮詢合格的獨立財務顧問。

既然您已經詳細審閱了這些策略，我們是否應該進行第 3 步：定義最佳執行策略？

提醒一下，我將呼叫 execution_analyst 子代理 (subagent)。為了幫助量身訂製執行計畫，請告訴我您是否有任何關於以下方面的偏好：

偏好的券商？
偏好的訂單類型 (例如，市價、限價)？
任何其他執行限制？
如果沒有，代理 (Agent) 將根據策略和您的個人資料提出普遍合適的方法。

使用者：沒有特別偏好
使用者：繼續

好的，了解。您沒有具體的執行偏好。

我現在將呼叫 execution_analyst 子代理 (subagent)。此代理 (Agent) 將採用 AAPL 的五種提議的交易策略 (概念上儲存在 proposed_trading_strategies_output 中)、您的中等風險態度和您的長期投資期間來建立詳細的執行計畫。

由於您沒有指定偏好，代理 (Agent) 將為每種類型的策略建議普遍合適的訂單類型、時機和成本考量方法。

好的，了解。您對執行沒有特別的偏好。

我現在將呼叫 execution_analyst 子代理 (subagent)。此代理 (Agent) 將制定一個詳細的執行計畫，該計畫針對 AAPL 提議的交易策略、您的中等風險態度和長期投資視野量身訂製，並使用普遍合適的方法，因為沒有給出具體的偏好。

代理 (Agent) 將考慮適當的訂單類型、潛在的時機考量和成本管理 (例如，最小化佣金和滑點) 等方面，適用於買入並持有、DRIP、價值平均、備兌看漲期權和 GARP 等策略。

好的，execution_analyst 子代理 (subagent) 已經為提議的 AAPL 交易策略提供了一個詳細的執行計畫，考慮到您的中等風險狀況、長期視野和缺乏具體的偏好。以下是以 markdown 格式呈現的執行計畫：

AAPL 交易策略的執行計畫分析 (中等風險，長期視野)
此計畫概述了專注於成本效益、風險管理和捕捉長期趨勢的執行方法，適合提議的策略和您的個人資料。

I. 基礎執行理念

目標：在審慎管理風險的同時，捕捉 AAPL 數月/數年的顯著趨勢。優先考慮戰略定位而非快速交易。
風險管理：接受正常的市場波動，但使用定義的停損來保護資本。避免過度槓桿。
成本控制：透過耐心的訂單放置 (限價單) 和較低的交易頻率來最小化佣金和滑點。
時間範圍焦點：主要使用日線圖和週線圖進行信號和管理，以過濾掉短期噪音。
II. 進場執行策略

最佳進場條件：
趨勢跟隨：在確認突破重要的長期阻力位或持續交易於關鍵上升移動平均線 (例如，50 週 MA) 之上時進場，通常由週收盤價確認。
戰略性積累：僅在主要長期上升趨勢仍然有效的情況下，在回檔至主要支撐區 (例如，200 日 MA，先前高點) 期間進場。尋找穩定跡象。
時機考量：要有耐心；等待信號確認 (例如，週末收盤價)。除非策略考慮在內，否則避免在重大已知事件 (例如，財報) 之前進場。
建議的訂單類型：限價單。優先考慮達到特定價格或更好的價格，而非立即執行。
突破進場：確認後將限價單略高於突破水平。
回檔積累：將限價單置於或略高於支撐水平。考慮使用多個限價單分批進場。
初始部位規模：固定分數風險。每筆交易承擔總資本的固定百分比風險 (例如，中等風險為 1% - 2.5%)。
計算：部位規模 = (總資本 * 風險 %) / (進場價格 - 初始停損價格)
初始停損策略：基於圖表 (結構性) 的停損 + 波動性緩衝 (ATR)。
將停損設置在使進場理由失效的水平之下 (例如，突破進場的近期擺動低點之下，回檔買入的支撐區之下)。
根據平均真實波幅 (例如，1.5-2.5 倍 ATR) 增加一個緩衝，以避免由於正常波動而過早觸發停損。
III. 持有與盤中管理策略

監控：主要是被動持有，定期審查 (例如，週線圖分析)。僅在接近關鍵水平時進行每日檢查。
動態風險管理 (停損調整)：
追蹤停損：建議在獲利可觀後使用。在新的較高低點、關鍵移動平均線之下或使用基於 ATR 的方法追蹤，以保護利潤，同時為趨勢留出空間。
移至損益兩平：在達到預定義的利潤 (例如，1 倍初始風險) 後，考慮將停損移至進場價格，以消除初始風險。
處理波動性：預期會有回檔。嚴格遵守停損。避免對短期波動做出情緒化反應。僅在觸發停損或重大基本面消息爆發時才重新評估。
IV. 積累 (加碼) 策略 (如果適用)

條件：僅在以下情況下才增加部位：1) 初始部位有利可圖，2) 主要趨勢強勁，3) 出現建設性的回檔至較高支撐位。
執行：在回檔支撐位使用限價單。後續進場通常應小於初始規模 (例如，50-75%)，以管理平均成本和風險。
風險調整：重新計算平均進場價格並調整整個部位的停損，確保總美元風險保持在投資組合限制內。
V. 部分賣出 (獲利了結 / 減碼) 策略

觸發條件：在以下情況下考慮部分獲利了結：
達到預定義的阻力/目標。
達到特定的風險/回報里程碑 (例如，2:1、3:1)。
觀察到顯著的趨勢減弱跡象 (例如，看跌背離)。
部位規模變得過大 (重新平衡)。
執行：使用略低於目標價格的限價單。賣出預定義的部分 (例如，1/3、1/2)。
管理剩餘部位：調整剩餘股票的停損 (例如，移至損益兩平或更緊密地追蹤)。
VI. 完全出場策略

獲利出場的條件：
確認的長期趨勢反轉 (例如，跌破主要 MA 或趨勢線)。
觸發追蹤停損。
達到最終長期目標 / 極度高估。
虧損出場的條件：
觸發初始或修訂的停損。
重大的負面基本面變化使長期論點失效。
訂單類型：
停損單：使用靜止的停損單 (觸發市價賣出) 或潛在的停損限價單 (價格保護但有不成交的風險)。
自主出場：在目標附近使用限價單進行計畫性出場。僅在由於突然的信號變化而需要立即出場時才使用市價單 (接受潛在的滑點)。
VII. 滑點與成本考量

對於像 AAPL 這樣的流動性強的股票，在正常市場時段內使用限價單的滑點對於零售規模來說通常很小。市價單會增加滑點風險。
使用限價單和較低的交易頻率通常可以最小化佣金成本和不利的價格執行。
(提醒：此執行計畫基於子代理 (subagent) 的輸出並遵循一般原則。它僅供參考，並非財務建議。實際執行涉及券商平台的具體情況、費用和即時市場動態。)

此詳細的執行計畫現在概念上已儲存在狀態鍵 execution_plan_output 中。

第 4 步：評估整體風險狀況

我們現在已經收集了市場分析 (market_data_analysis_output)，制定了潛在的交易策略 (proposed_trading_strategies_output)，並定義了詳細的執行計畫 (execution_plan_output)。

最後一步是評估此潛在財務計畫的整體風險狀況。我將呼叫 risk_analyst 子代理 (subagent) 來執行此評估。

risk_analyst 將使用：

市場資料分析 (market_data_analysis_output)。
提議的交易策略 (proposed_trading_strategies_output)。
執行計畫 (execution_plan_output)。
您聲明的風險態度 (中等)。
您聲明的投資期間 (長期)。
代理 (Agent) 將評估這些組成部分的一致性，突顯潛在風險 (如集中風險、執行風險或與您的個人資料不一致)，並提供全面的風險評估。

我是否應該繼續呼叫 risk_analyst 子代理 (subagent)？

太好了。risk_analyst 子代理 (subagent) 已完成最後一步，提供了與提議的 AAPL 投資計畫相關的全面風險狀況評估。以下是以 markdown 格式呈現的風險評估：

綜合風險分析報告：AAPL 投資計畫 (中等風險，長期視野)
本報告根據市場分析、提議的策略、執行計畫和您的使用者個人資料評估整體風險。(注意：先前步驟的具體細節是根據此類個人資料的典型計畫假設的)。

1. 風險執行摘要

主要風險：
集中風險：對單一股票 (AAPL) 的重大曝險。表現嚴重依賴這家公司。
市場風險：易受大盤下跌、科技股輪動和公司特定負面事件 (例如，增長放緩、監管問題) 的影響。
策略風險 (如果使用備兌看漲期權)：賣出備兌看漲期權會限制上漲潛力並增加管理複雜性。
整體定性風險評估：中等。該計畫與長期觀點一致，但單一股票的焦點提高了與多元化投資組合相比的風險。這僅在 AAPL 部位是您總多元化資產的適當部分時才適合「中等」承受能力。如果 AAPL 佔您財富的很大一部分，則風險水平可能為高。
2. 市場風險

已識別：方向性風險 (價格下跌)、波動性風險、科技股風險、事件風險 (財報、產品發布)、通膨/利率風險以及關鍵的集中風險。
評估：長期視野有助於減輕短期波動，但 AAPL 的長期下跌或停滯可能會顯著影響目標。集中風險是最突出的風險 – 在此特定計畫中，AAPL 的不佳表現無法在其他地方得到彌補。
緩解措施：
多元化 (關鍵)：確保此 AAPL 部位是更廣泛、充分多元化的投資組合的一部分。為 AAPL 定義最大分配百分比。
部位規模：遵守規模規則；考慮分批進場 (DCA)。
審查觸發器：設定根據回檔或基本面變化重新評估持股的標準。
3. 流動性風險

已識別：無法以期望價格交易的風險。
評估：由於交易量大，AAPL 普通股的風險非常低。期權流動性對於標準行使價/到期日通常良好，但可能會有所不同。使用限價單與最小化此風險的目標一致。
緩解措施：使用限價單；交易流動性好的期權 (如果適用)；在正常市場時段交易。
4. 對手方與平台風險

已識別：券商破產 (由 SIPC 等保護計畫緩解)、平台中斷/故障、網路安全風險。
評估：使用大型、受監管的券商可以最小化破產風險。平台風險不常見但可能發生。
緩解措施：使用信譽良好、受監管的券商；啟用雙重認證 (2FA)；有備用存取方法 (電話服務台)；注意平台狀態。
5. 操作與技術風險

已識別：訂單輸入的人為錯誤、個人系統故障 (網路/電腦)、未能遵守計畫 (情緒化決策)、未能正確管理期權。
評估：執行錯誤可能導致損失。遵守計畫對於長期策略至關重要。
緩解措施：使用交易檢查清單；審查確認；維護清晰的計畫文件；設定警示 (價格、到期日)；考慮備用網路。
6. 策略特定與模型風險

已識別：核心前提 (AAPL 長期增長) 錯誤的風險；如果 AAPL 表現不佳的機會成本；使用 DCA 加碼虧損的風險；備兌看漲期權的上限上漲/履約風險；策略層面的集中風險；「黑天鵝」事件風險。
評估：策略成功取決於 AAPL 的未來。集中風險是固有的。備兌看漲期權涉及權衡 (收入與最大增長)。
緩解措施：定期監控 AAPL 基本面；重新評估備兌看漲期權與目標的適用性；嚴格遵守投資組合分配限制；考慮負面情境。
7. 交易者的心理風險

已識別：恐懼/恐慌性拋售；不耐煩；確認偏誤；後悔 (尤其是在備兌看漲期權方面)；在經濟衰退期間難以遵守 DCA。
評估：長期投資需要情緒紀律。對於中等風險的投資者來說，在回檔期間持有一個集中的部位可能會帶來壓力。
緩解措施：遵守書面計畫；專注於長期視野；保留交易日誌 (可選)；設定切合實際的期望；如果可能，自動化供款。
8. 與使用者個人資料的整體契合度與結論

契合度：通常與長期期間一致。如果透過整個投資組合的多元化來管理集中風險，則可以與中等風險一致。執行偏好非常適合。
潛在的不一致：
集中風險：如果 AAPL 佔總資產的百分比過大，實際風險可能會超過「中等」。
備兌看漲期權：增加複雜性並限制上漲潛力，可能與純粹的長期增長焦點相衝突。確保對這種權衡感到舒適。
關鍵考量：
多元化至關重要：對於「中等」狀況的適用性在很大程度上取決於此 AAPL 部位之外的多元化。
信念與紀律：需要對 AAPL 的未來有信心，並有紀律地度過波動。
定期審查：定期重新評估 AAPL 的投資論點。
重要免責聲明：僅供教育與資訊目的使用。

提供的資訊，包括分析、策略、執行計畫和風險評估，均由 AI 模型為教育目的產生。它們不構成財務建議、投資建議或買賣證券的要約。Google 對準確性或完整性不作任何保證。依賴此資訊的風險完全由您自己承擔。金融市場涉及風險；過去的表現並不保證未來的結果。在做出任何投資決策之前，請務必進行自己的徹底獨立研究並諮詢合格的獨立財務顧問。您使用此工具即表示您承認並接受本免責聲明。

此最終風險評估現在概念上已儲存在狀態鍵 final_risk_assessment_output 中。

我們現在已經完成了結構化的財務諮詢流程：

分析了 AAPL 的市場資料。
根據您的個人資料制定了潛在的交易策略。
定義了詳細的執行計畫。
評估了提議計畫的整體風險狀況。
您對此最終風險評估或流程的任何其他部分有任何疑問嗎？

使用者：不用了，謝謝

不客氣！我們現在已經完成了整個流程，從分析 AAPL 到評估針對您的中等風險態度和長期投資視野量身訂製的潛在策略的整體風險。

請記住，今天提供的所有資訊，包括策略和風險評估，僅供教育和資訊目的，並不構成財務建議。在做出任何投資決策之前，請務必進行自己的研究並諮詢合格的獨立財務顧問。

如果您將來決定探索另一個股票代碼或重新審視此流程，請隨時提出。祝您有美好的一天！

使用者：你也是

謝謝！
```

## 執行測試

若要執行測試和評估，請安裝額外的依賴項：

```bash
poetry install --with dev
```

然後可以使用 `pytest` 模組從 `financial-advisor` 目錄執行測試和評估：

```bash
python3 -m pytest tests
python3 -m pytest eval
```

`tests` 會對範例請求執行代理 (agent)，並確保每個元件都能正常運作。`eval` 是使用 ADK 中的 `AgentEvaluator` 來評估代理 (agent) 的示範。它會向代理 (agent) 發送幾個請求，並期望代理 (agent) 的回應能與預先定義的回應合理地相符。


## 部署

財務顧問可以使用以下命令部署到 Vertex AI Agent Engine：

```bash
poetry install --with deployment
python3 deployment/deploy.py --create
```

部署完成後，它將列印如下所示的一行：

```
Created remote agent: projects/<PROJECT_NUMBER>/locations/<PROJECT_LOCATION>/reasoningEngines/<AGENT_ENGINE_ID>
```

如果您忘記了 AGENT_ENGINE_ID，您可以使用以下命令列出現有的代理 (agent)：

```bash
python3 deployment/deploy.py --list
```

輸出將如下所示：

```
All remote agents:

123456789 ("financial_advisor")
- Create time: 2025-05-12 12:35:34.245431+00:00
- Update time: 2025-05-12 12:36:01.421432+00:00
```

您可以使用 `test_deployment.py` 指令碼與已部署的代理 (agent) 互動
```bash
$ export USER_ID=<any string>
$ python3 deployment/test_deployment.py --resource_id=${AGENT_ENGINE_ID} --user_id=${USER_ID}
Found agent with resource ID: ...
Created session for user ID: ...
Type 'quit' to exit.
Input: Hello, what can you do for me?
Response: Hello! I can guide you through a structured process to receive financial advice. We'll work together with a team of expert subagents to:

1.  **Analyze a market ticker**: We'll start by having you provide a market ticker symbol (e.g., AAPL, GOOGL). Our data analyst subagent will then provide a comprehensive analysis of it.
2.  **Develop trading strategies**: Based on the market analysis and your risk attitude and investment period, our trading strategist subagent will propose potential trading strategies.
3.  **Define an execution plan**: Next, our execution specialist subagent will create a detailed plan for implementing the chosen strategy, considering factors like order types and timing.
4.  **Evaluate the overall risk**: Finally, our risk analyst subagent will assess the overall risk of the financial plan, ensuring it aligns with your goals and risk tolerance.

Would you like to begin by providing a market ticker symbol for analysis?
```

若要刪除已部署的代理 (agent)，您可以執行以下命令：

```bash
python3 deployment/deploy.py --delete --resource_id=${AGENT_ENGINE_ID}
```

## 自訂

1. 增強 Data_Analyst 模組搜尋功能與專業股票儲存庫的整合：
為了賦予 data_analyst 模組更全面的洞察力，請擴展其搜尋功能，以直接存取並與專業的股票相關資料儲存庫整合。這將涉及連接到包含即時和歷史股價、交易量、公司財務報表 (例如，損益表、資產負債表、現金流量表)、新聞文章、分析師評級以及潛在的替代資料來源 (例如，用於供應鏈分析的衛星圖像、社交媒體情緒) 的資料庫、API 或資料湖。目標是為資料分析師提供更豐富、更精細且特定領域的資料集，以進行深入的市場研究、趨勢分析和預測模型建立。
2. 建立並實作多樣化的分析師角色以實現量身訂製的存取與功能：
系統性地定義並實作更廣泛的分析師角色或基於角色的存取設定，以滿足特定的分析需求和組織結構。這涉及識別不同類型的資料分析師 (例如，量化分析師、基本面分析師、風險分析師、合規分析師、市場研究員)，並對應其獨特的資料存取要求、工具功能和報告需求。透過分配特定的角色或人物誌，系統可以確保每位分析師只能存取其任務所需的相關資料、工具和功能，從而提高安全性、簡化工作流程並防止資訊過載。這也允許自訂使用者介面和分析儀表板，以更好地適應每個角色的偏好和專業知識。
3. 反覆優化提示工程以獲得最佳結果的精確度與相關性：
持續反覆運算用於提示工程的策略和技術，以從生成式 AI 模型或搜尋演算法中引出更精確、相關且可行的結果。此過程涉及實驗各種提示結構、關鍵字、上下文資訊、範例和約束，以引導 AI 產生直接解決使用者意圖和特定資訊需求的輸出。定期的回饋循環、不同提示的 A/B 測試以及對結果品質的持續分析對於優化提示至關重要。目標是最小化不相關或不準確的資訊，增強輸出的清晰度和簡潔性，並確保結果與分析目標始終保持一致。
