# ARCHITECTURE.md - SRE Assistant è¯é‚¦åŒ–æ¶æ§‹è¨­è¨ˆ

## 1. æ¶æ§‹æ¼”é€²æ¦‚è¦½

### 1.1 ç•¶å‰æ¶æ§‹ (v2.x - å–®é«”æ™ºèƒ½ä»£ç†)

ç•¶å‰çš„ SRE Assistant æ¡ç”¨é›†ä¸­å¼æ¶æ§‹ï¼Œä»¥ `SREWorkflow` ç‚ºæ ¸å¿ƒå”èª¿å››å€‹è™•ç†éšæ®µï¼š

```mermaid
graph TB
    subgraph "ç•¶å‰æ¶æ§‹ - å–®é«”æ™ºèƒ½"
        SREWorkflow[SRE Workflow<br/>ä¸­å¤®å”èª¿å™¨]
        
        SREWorkflow --> Phase1[è¨ºæ–·éšæ®µ<br/>ParallelAgent]
        SREWorkflow --> Phase2[ä¿®å¾©éšæ®µ<br/>ConditionalAgent]
        SREWorkflow --> Phase3[è¦†ç›¤éšæ®µ<br/>LlmAgent]
        SREWorkflow --> Phase4[å„ªåŒ–éšæ®µ<br/>LoopAgent]
    end
```

### 1.2 ç›®æ¨™æ¶æ§‹ (v3.x - è¯é‚¦åŒ–ç”Ÿæ…‹ç³»çµ±)

æœªä¾†å°‡æ¼”é€²ç‚ºå¤šå€‹å°ˆæ¥­åŒ–ä»£ç†å”åŒå·¥ä½œçš„è¯é‚¦æ¶æ§‹ï¼š

```mermaid
graph TB
    subgraph "è¯é‚¦åŒ–æ¶æ§‹ - å°ˆæ¥­åˆ†å·¥"
        Orchestrator[SRE Orchestrator<br/>è¯é‚¦å”èª¿å™¨]
        
        subgraph "å°ˆæ¥­åŒ–ä»£ç†ç¾¤"
            IncidentAgent[äº‹ä»¶è™•ç† Assistant]
            PredictiveAgent[é æ¸¬ç¶­è­· Assistant]
            DeployAgent[éƒ¨ç½²ç®¡ç† Assistant]
            ChaosAgent[æ··æ²Œå·¥ç¨‹ Assistant]
            CapacityAgent[å®¹é‡è¦åŠƒ Assistant]
            CostAgent[æˆæœ¬å„ªåŒ– Assistant]
        end
        
        Orchestrator -.->|A2A Protocol| IncidentAgent
        Orchestrator -.->|A2A Protocol| PredictiveAgent
        Orchestrator -.->|A2A Protocol| DeployAgent
        Orchestrator -.->|A2A Protocol| ChaosAgent
        Orchestrator -.->|A2A Protocol| CapacityAgent
        Orchestrator -.->|A2A Protocol| CostAgent
    end
```

## 2. æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

### 2.1 æ¼¸é€²å¼æ¼”é€²
- **Phase 1-2**: ç¶­æŒå–®é«”æ¶æ§‹ï¼Œå„ªåŒ–æ ¸å¿ƒåŠŸèƒ½
- **Phase 3-4**: é€æ­¥æ‹†åˆ†ç‚ºå°ˆæ¥­åŒ–ä»£ç†
- **é•·æœŸé¡˜æ™¯**: å®Œå…¨è¯é‚¦åŒ–ã€è‡ªå­¸ç¿’çš„ä»£ç†ç”Ÿæ…‹

### 2.2 é—œæ³¨é»åˆ†é›¢
- **å°ˆæ¥­åŒ–**: æ¯å€‹ä»£ç†å°ˆæ³¨å–®ä¸€é ˜åŸŸ
- **å¯çµ„åˆ**: ä»£ç†å¯è‡ªç”±çµ„åˆè™•ç†è¤‡é›œå ´æ™¯
- **ç¨ç«‹æ¼”é€²**: å„ä»£ç†ç¨ç«‹å‡ç´šä¸å½±éŸ¿æ•´é«”

### 2.3 äººæ©Ÿå”åŒ
- **HITL æ©Ÿåˆ¶**: é—œéµæ±ºç­–ä¿ç•™äººå·¥å¯©æ ¸
- **ChatOps**: è‡ªç„¶èªè¨€æ§åˆ¶æ‰€æœ‰æ“ä½œ
- **é€æ˜åº¦**: æ±ºç­–éç¨‹å¯å¯©è¨ˆå¯è§£é‡‹

## 3. ç³»çµ±çµ„ä»¶æ¶æ§‹

### 3.1 æ ¸å¿ƒå±¤ç´š

```mermaid
graph TB
    subgraph "ä»‹é¢å±¤"
        WebUI[Web Dashboard]
        ChatOps[Slack/Teams]
        API[REST/GraphQL]
        CLI[å‘½ä»¤è¡Œå·¥å…·]
    end
    
    subgraph "å”èª¿å±¤"
        Orchestrator[è¯é‚¦å”èª¿å™¨]
        EventBus[äº‹ä»¶ç¸½ç·š]
        Scheduler[ä»»å‹™èª¿åº¦å™¨]
    end
    
    subgraph "ä»£ç†å±¤"
        AgentRegistry[ä»£ç†è¨»å†Šä¸­å¿ƒ]
        AgentFactory[ä»£ç†å·¥å» ]
        Agents[å°ˆæ¥­åŒ–ä»£ç†ç¾¤]
    end
    
    subgraph "åŸºç¤è¨­æ–½å±¤"
        Memory[çµ±ä¸€è¨˜æ†¶åº«]
        Config[é…ç½®ä¸­å¿ƒ]
        Auth[èªè­‰æˆæ¬Š]
        Monitoring[ç›£æ§è¿½è¹¤]
    end
    
    WebUI --> Orchestrator
    ChatOps --> Orchestrator
    API --> Orchestrator
    CLI --> Orchestrator
    
    Orchestrator --> EventBus
    Orchestrator --> Scheduler
    EventBus --> AgentRegistry
    Scheduler --> AgentFactory
    
    AgentFactory --> Agents
    AgentRegistry --> Agents
    
    Agents --> Memory
    Agents --> Config
    Agents --> Auth
    Agents --> Monitoring
```

### 3.2 ä»£ç†é–“é€šè¨Šæ¶æ§‹ (A2A)

```yaml
# A2A é€šè¨Šå”è­°è¨­è¨ˆ
protocol:
  discovery:
    registry: "agent-registry.sre.local"
    heartbeat_interval: 30s
    
  messaging:
    format: "protobuf"
    transport: "grpc"
    timeout: 60s
    
  security:
    authentication: "mTLS"
    authorization: "RBAC"
    encryption: "AES-256"
```

## 4. å°ˆæ¥­åŒ–ä»£ç†è¨­è¨ˆ

### 4.1 äº‹ä»¶è™•ç† Assistant

```python
class IncidentHandlerAssistant(BaseAgent):
    """è™•ç†ç”Ÿç”¢ç’°å¢ƒäº‹ä»¶çš„å°ˆæ¥­åŒ–ä»£ç†"""
    
    capabilities = [
        "incident_detection",      # äº‹ä»¶æª¢æ¸¬
        "root_cause_analysis",     # æ ¹å› åˆ†æ
        "automated_remediation",   # è‡ªå‹•ä¿®å¾©
        "postmortem_generation"    # äº‹å¾Œæª¢è¨
    ]
    
    tools = [
        PrometheusQueryTool(),       # æ™®ç¾…ç±³ä¿®æ–¯æŸ¥è©¢å·¥å…·
        KubernetesOperationTool(),   # å®¹å™¨æ“ä½œå·¥å…·
        GrafanaIntegrationTool()     # Grafana æ•´åˆå·¥å…·
    ]
    
    memory_collections = [
        "incident_history",        # äº‹ä»¶æ­·å²
        "runbook_library",         # é‹è¡Œæ‰‹å†Šåº«
        "postmortem_archive"       # äº‹å¾Œæª¢è¨åº«
    ]
```

### 4.2 é æ¸¬ç¶­è­· Assistant

```python
class PredictiveMaintenanceAssistant(BaseAgent):
    """é æ¸¬å’Œé é˜²ç³»çµ±å•é¡Œçš„å°ˆæ¥­åŒ–ä»£ç†"""
    
    capabilities = [
        "anomaly_detection",       # ç•°å¸¸æª¢æ¸¬
        "failure_prediction",      # æ•…éšœé æ¸¬
        "capacity_forecasting",    # å®¹é‡é æ¸¬
        "trend_analysis"           # è¶¨å‹¢åˆ†æ
    ]
    
    ml_models = [
        "time_series_forecasting",
        "anomaly_detection_autoencoder",
        "failure_prediction_random_forest"
    ]
```

### 4.3 éƒ¨ç½²ç®¡ç† Assistant

```python
class DeploymentAssistant(BaseAgent):
    """ç®¡ç†éƒ¨ç½²æµç¨‹çš„å°ˆæ¥­åŒ–ä»£ç†"""
    
    capabilities = [
        "deployment_planning",     # éƒ¨ç½²è¦åŠƒ
        "canary_analysis",        # é‡‘çµ²é›€åˆ†æ
        "rollback_management",    # å›æ»¾ç®¡ç†
        "dependency_tracking"     # ä¾è³´è¿½è¹¤
    ]
    
    integrations = [
        "GitHub/GitLab",
        "ArgoCD/Flux",
        "Jenkins/CircleCI",
        "Helm/Kustomize"
    ]
```

## 5. çµ±ä¸€åŸºç¤è¨­æ–½

### 5.1 è¨˜æ†¶é«”æ¶æ§‹
Weaviate å‘é‡æ•¸æ“šåº«ï¼ŒPostgreSQL æ–‡æª”æ•¸æ“šåº«ï¼ŒRedis è¨˜æ†¶é«”æ•¸æ“šåº«

```mermaid
graph LR
    subgraph "çµ±ä¸€è¨˜æ†¶åº«"
		    Cache[è¨˜æ†¶é«”<br/>Redis]
        VectorDB[å‘é‡æ•¸æ“šåº«<br/>Weaviate]
        DocumentDB[æ–‡æª”æ•¸æ“šåº«<br/>PostgreSQL]

    end
    
    subgraph "è¨˜æ†¶é¡å‹"
        ShortTerm[çŸ­æœŸè¨˜æ†¶<br/>è¨˜æ†¶é«”]
        LongTerm[é•·æœŸè¨˜æ†¶<br/>ç£ç¢Ÿ]
        Procedural[ç¨‹åºè¨˜æ†¶<br/>è¨˜æ†¶é«”]
        Semantic[èªç¾©è¨˜æ†¶<br/>é ˜åŸŸçŸ¥è­˜]
    end
    
    ShortTerm --> VectorDB
    LongTerm --> TimeSeriesDB
    Semantic --> DocumentDB
```

### 5.2 é…ç½®ç®¡ç†

```yaml
# åˆ†å±¤é…ç½®æ¶æ§‹
configuration:
  global:           # å…¨å±€é…ç½®
    slo_targets:
      availability: 99.95%
      latency_p99: 500ms
      
  agent_specific:   # ä»£ç†ç‰¹å®šé…ç½®
    incident_handler:
      auto_remediation_threshold: "P2"
      escalation_timeout: 300s
      
  environment:      # ç’°å¢ƒé…ç½®
    production:
      high_availability: true
      backup_enabled: true
    staging:
      chaos_testing: enabled
```

## 6. å¯¦æ–½è·¯ç·šåœ–

### Phase 1: åŸºç¤å¼·åŒ– (ç•¶å‰)
- âœ… é€²éšå·¥ä½œæµç¨‹æ¶æ§‹
- âœ… çµ±ä¸€èªè­‰ç³»çµ±
- âœ… RAG å¼•ç”¨ç³»çµ±
- ğŸ”„ æ™ºæ…§åˆ†è¨ºç³»çµ±

### Phase 2: åŠŸèƒ½æ“´å±• (3-6å€‹æœˆ)
- é æ¸¬ç¶­è­·èƒ½åŠ›
- éƒ¨ç½²è‡ªå‹•åŒ–
- A2A å”è­°å¯¦ç¾
- ChatOps æ•´åˆ

### Phase 3: å°ˆæ¥­åŒ–æ‹†åˆ† (6-12å€‹æœˆ)
- ç¨ç«‹äº‹ä»¶è™•ç†ä»£ç†
- æ··æ²Œå·¥ç¨‹ä»£ç†
- å®¹é‡è¦åŠƒä»£ç†
- ä»£ç†è¨»å†Šä¸­å¿ƒ

### Phase 4: è¯é‚¦åŒ–ç”Ÿæ…‹ (12å€‹æœˆ+)
- å®Œæ•´ A2A é€šè¨Š
- è·¨çµ„ç¹”å”ä½œ
- è‡ªå­¸ç¿’èƒ½åŠ›
- é–‹æ”¾ç”Ÿæ…‹ç³»çµ±

## 7. æŠ€è¡“æ£§é¸æ“‡

### 7.1 æ ¸å¿ƒæŠ€è¡“
- **æ¡†æ¶**: Google ADK
- **èªè¨€**: Python 3.11+
- **LLM**: Gemini Pro / GPT-4
- **å‘é‡DB**: Weaviate / Vertex AI Vector Search

### 7.2 åŸºç¤è¨­æ–½
- **å®¹å™¨**: Docker / Kubernetes
- **èªè­‰æˆæ¬Š**: OAuth 2.0 / JWT
- **ç›£æ§**: OpenTelemetry
- **æ—¥èªŒ**: Grafana Loki
- **è¦–è¦ºåŒ–**: Grafana OSS / Grafana Cloud

### 7.3 å”è­°æ¨™æº–
- **A2A**: gRPC + Protocol Buffers
- **API**: REST
- **äº‹ä»¶**: CloudEvents
- **é…ç½®**: YAML / JSON Schema

## 8. å®‰å…¨æ¶æ§‹

### 8.1 èªè­‰æˆæ¬Š
```mermaid
graph TB
    subgraph "å¤šå±¤å®‰å…¨æ¶æ§‹"
        L1[API Gateway<br/>Rate Limiting]
        L2[Service Mesh<br/>mTLS]
        L3[RBAC<br/>ç´°ç²’åº¦æˆæ¬Š]
        L4[Audit Logging<br/>åˆè¦å¯©è¨ˆ]
    end
    
    Request --> L1
    L1 --> L2
    L2 --> L3
    L3 --> L4
    L4 --> Agent
```

### 8.2 æ•¸æ“šå®‰å…¨
- **åŠ å¯†**: å‚³è¼¸ä¸­ (TLS 1.3) + éœæ…‹ (AES-256)
- **å¯†é‘°ç®¡ç†**: Google Secret Manager / HashiCorp Vault
- **éš±ç§**: PII é®ç½© + GDPR åˆè¦

## 9. æ€§èƒ½ç›®æ¨™

### 9.1 SLO å®šç¾©
| æŒ‡æ¨™ | ç›®æ¨™ | æ¸¬é‡æ–¹æ³• |
|------|------|----------|
| å¯ç”¨æ€§ | 99.95% | Uptime ç›£æ§ |
| è¨ºæ–·å»¶é² | < 15s | P99 æ¸¬é‡ |
| ä¿®å¾©æˆåŠŸç‡ | > 85% | æœˆåº¦çµ±è¨ˆ |
| èª¤å ±ç‡ | < 5% | äººå·¥å¯©æ ¸ |

### 9.2 æ“´å±•æ€§
- **æ°´å¹³æ“´å±•**: æ”¯æ´ 100+ ä¸¦ç™¼äº‹ä»¶
- **ä»£ç†æ•¸é‡**: æ”¯æ´ 50+ å°ˆæ¥­ä»£ç†
- **æ•¸æ“šè¦æ¨¡**: PB ç´šæ—¥èªŒåˆ†æ

## 10. ç›£æ§èˆ‡å¯è§€æ¸¬æ€§

### 10.1 æŒ‡æ¨™å±¤ç´š
```yaml
metrics:
  business:
    - incident_mttr
    - auto_remediation_rate
    - cost_savings
    
  application:
    - agent_response_time
    - tool_execution_duration
    - memory_retrieval_latency
    
  infrastructure:
    - cpu_utilization
    - memory_usage
    - network_throughput
```

### 10.2 è¿½è¹¤æ¶æ§‹
- **åˆ†æ•£å¼è¿½è¹¤**: OpenTelemetry
- **æ±ºç­–è¿½è¹¤**: Agent Decision Tree
- **å¯©è¨ˆæ—¥èªŒ**: Immutable Event Log

## 11. ç½é›£æ¢å¾©

### 11.1 å‚™ä»½ç­–ç•¥
- **è¨˜æ†¶é«”å‚™ä»½**: æ¯å°æ™‚å¢é‡ + æ¯æ—¥å…¨é‡
- **é…ç½®å‚™ä»½**: Git ç‰ˆæœ¬æ§åˆ¶
- **ç‹€æ…‹å‚™ä»½**: Multi-region è¤‡è£½

### 11.2 æ•…éšœè½‰ç§»
- **ä¸»å‚™åˆ‡æ›**: < 30 ç§’
- **æ•¸æ“šæ¢å¾©**: RPO < 1 å°æ™‚, RTO < 4 å°æ™‚
- **é™ç´šæ¨¡å¼**: æ ¸å¿ƒåŠŸèƒ½å„ªå…ˆ

## 12. é–‹ç™¼è¦ç¯„

### 12.1 ä»£ç¢¼çµæ§‹
éµå¾ª [ADK å®˜æ–¹ç›®éŒ„çµæ§‹](adk-repository-structure.md)

### 12.2 æ¸¬è©¦ç­–ç•¥
- **å–®å…ƒæ¸¬è©¦**: > 80% è¦†è“‹ç‡
- **æ•´åˆæ¸¬è©¦**: ç«¯åˆ°ç«¯å ´æ™¯
- **æ··æ²Œæ¸¬è©¦**: ç”Ÿç”¢ç’°å¢ƒéŸŒæ€§

### 12.3 æ–‡æª”æ¨™æº–
- **API æ–‡æª”**: OpenAPI 3.0
- **æ¶æ§‹åœ–**: Mermaid / Draw.io
- **æ±ºç­–è¨˜éŒ„**: ADR æ ¼å¼

---

**æ–‡æª”ç‰ˆæœ¬**: 3.0.0  
**æœ€å¾Œæ›´æ–°**: 2025-08-25  
**ç¶­è­·è€…**: SRE Platform Team